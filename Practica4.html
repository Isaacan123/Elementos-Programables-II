<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Portafolio de Valeria e Isaac A.</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Free HTML Templates" name="keywords">
    <meta content="Free HTML Templates" name="description">

    <!-- Favicon -->
    <link href="img/favicon.ico" rel="icon">

    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet"> 

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">

    <!-- Libraries Stylesheet -->
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <link href="lib/lightbox/css/lightbox.min.css" rel="stylesheet">

    <!-- Customized Bootstrap Stylesheet -->
    <link href="css/style.css" rel="stylesheet">
</head>

<body data-spy="scroll" data-target=".navbar" data-offset="51">
    <!-- Navbar Start -->
    <nav class="navbar fixed-top shadow-sm navbar-expand-lg bg-light navbar-light py-3 py-lg-0 px-lg-5">
        <a href="index.html" class="navbar-brand ml-lg-3">
            <h1 class="m-0 display-5"><span class="text-primary">Aleman</span> y Huitrón</h1>
        </a>
        <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse px-lg-3" id="navbarCollapse">
            <div class="navbar-nav m-auto py-0">
                <a href="#home" class="nav-item nav-link active">Inicio</a>
                <a href="#about" class="nav-item nav-link">Nosotros</a>
                <a href="#qualification" class="nav-item nav-link"></a>
                <a href="#skill" class="nav-item nav-link">Progreso</a>
                <a href="#blog" class="nav-item nav-link">Practicas</a>
                <a href="#service" class="nav-item nav-link">Contactame</a>
            </div>
            <a href="" class="btn btn-outline-primary d-none d-lg-block">Hire Me</a>
        </div>
    </nav>
    <!-- Navbar End -->


    <!-- Video Modal Start -->
    <div class="modal fade" id="videoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>        
                    <!-- 16:9 aspect ratio -->
                    <div class="embed-responsive embed-responsive-16by9">
                        <iframe class="embed-responsive-item" src="" id="video"  allowscriptaccess="always" allow="autoplay"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Video Modal End -->


    <!-- Header Start -->
    <div class="container-fluid bg-primary d-flex align-items-center mb-5 py-5" id="home" style="min-height: 50;">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-5 px-1 pl-lg-2 pb-1 pb-lg-0">
                    <img class="img-fluid w-100 rounded-circle shadow-sm" src="img/FOTO1.jpg" alt="">
                </div>
                <div class="col-lg-7 text-center text-lg-left">
                    <h1 class="display-3 text-uppercase text-primary mb-2" style="-webkit-text-stroke: 1px #ffffff;">Practica 4:</h1>
                    <h1 class="typed-text-output d-inline font-weight-lighter text-white"></h1>
                    <div class="typed-text d-none"> Proyecto con MQTT</div>
                    <div class="d-flex align-items-center justify-content-center justify-content-lg-start pt-5">
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    

    <!-- Qualification Start -->
    <div class="container-fluid py-5" id="qualification">
        <div class="container">
            <div class="position-relative d-flex align-items-center justify-content-center">
                <h5 class="display-3 text-uppercase text-white" style="-webkit-text-stroke: 1px #dee2e6;">Resumen</h5>
                <h1 class="position-absolute text-uppercase text-primary">Resumen</h1></div>
<p>Esta práctica se enfocó en la medición del tiempo de ida y vuelta de mensajes utilizando el protocolo MQTT entre dispositivos (computadora y ESP32). El objetivo fue evaluar el desempeño de la red y visualizar los resultados mediante estadísticas y gráficas.</p>            </div>
            <div class="row align-items-center">
                <div class="col-lg-6">
                </div>
                                    <div class="container-fluid py-5" id="qualification">
                                        <div class="container">
                                            <div class="position-relative d-flex align-items-center justify-content-center">
                                                <h5 class="display-3 text-uppercase text-white" style="-webkit-text-stroke: 1px #dee2e6;">Introducción</h5>
                                                <h1 class="position-absolute text-uppercase text-primary">Introducción</h1>
                                            </div>
                                            <p>MQTT (Message Queuing Telemetry Transport) es un protocolo de mensajería ligero basado en el modelo publicador/suscriptor, diseñado especialmente para dispositivos con recursos limitados o redes poco confiables. Es muy utilizado en proyectos de IoT (Internet de las Cosas).
                                            <ul>
                                            <li>Attiny: de pequeña escala, enfocado en aplicaciones de bajo consumo y con recursos limitados.
                                                <li>Arduino Uno: Microcontrolador de uso común, basado en el chip ATmega328P, con soporte amplio y comunidad activa.
                                             <li>ESP32-C6: Microcontrolador más avanzado con capacidades de conectividad Wi-Fi y Bluetooth.
                                          </ul>  </p>                                                                                                                                                                                                                                                                                        
                                                   </p>
     <br>


                </center>  
         <div class="container-fluid py-5" id="qualification">
            <div class="container">
                <div class="position-relative d-flex align-items-center justify-content-center">
                    <h5 class="display-3 text-uppercase text-white" style="-webkit-text-stroke: 1px #e69b69;">Desarrollo:</h5>
                    <h1 class="position-absolute text-uppercase text-primary">Desarrollo:</h1>
                </div>
              <p>Esta práctica se dividió en cuatro partes:</p>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
</body>
<p>Primera parte: Se enviaron datos a MQTT desde la computadora. Se midió el tiempo que tarda el mensaje en ir y regresar, y se elaboró una gráfica con el tiempo promedio y la desviación estándar. En total, se enviaron 1000 mensajes.</p>
<div>
<center>
    <div class="code-container">
        <div class="code-header">Python - Medición de tiempos con MQTT</div>
        <pre><code class="language-python"> 
import paho.mqtt.client as mqtt
import time
import numpy as np
import matplotlib.pyplot as plt

BROKER = "test.mosquitto.org"  # Cambia esto si usas otro broker
TOPIC = "elementos2/huber/IsaacAleman"
NUM_MESSAGES = 10000
times = []
send_times = {}

# Callback cuando se recibe un mensaje
def on_message(client, userdata, msg):
    global times
    received_time = time.time()
    message_id = msg.payload.decode()
    print(f"Mensaje recibido: {message_id}")
    if message_id in send_times:
        round_trip_time = received_time - send_times.pop(message_id)
        times.append(round_trip_time)

# Configurar cliente MQTT
client = mqtt.Client()
client.on_message = on_message
client.connect(BROKER, 1883, 60)
client.subscribe(TOPIC)
client.loop_start()

# Enviar mensajes y medir tiempos
for i in range(NUM_MESSAGES):
    msg_id = str(i)
    print(f"Enviando mensaje: {msg_id}")
    send_times[msg_id] = time.time()
    client.publish(TOPIC, msg_id)
    time.sleep(0.01)  # Pequeña pausa para evitar congestión

# Esperar a que todos los mensajes sean recibidos
time.sleep(5)
client.loop_stop()
client.disconnect()

# Calcular estadísticas
mean_time = np.mean(times)
std_dev = np.std(times)

# Graficar resultados con mejor claridad
plt.figure(figsize=(12, 6))
plt.plot(times, marker='o', linestyle='-', markersize=3, color='b', alpha=0.7, label="Tiempos de ida y vuelta")
plt.axhline(mean_time, color='r', linestyle='--', linewidth=2, label=f'Promedio: {mean_time:.5f}s')
plt.fill_between(range(len(times)), mean_time - std_dev, mean_time + std_dev, color='r', alpha=0.2, label='Desviación estándar')
plt.xlabel("Número de mensaje")
plt.ylabel("Tiempo (s)")
plt.title("Tiempos de ida y vuelta en MQTT")
plt.legend()
plt.grid(True, linestyle='--', alpha=0.6)
plt.xticks(rotation=45)
plt.show()

print(f"Tiempo promedio: {mean_time:.5f} s")
print(f"Desviación estándar: {std_dev:.5f} s")
</code></pre>
</div>
<img src="img/microcontroladores/grafica.jpg.png" width="500px" alt="esp32"><br>

Segunda parte: De manera similar, se enviaron los mismos datos, pero esta vez desde un ESP32-C6. También se realizó una gráfica con los resultados obtenidos.
<div>
    <center>
        <div class="code-container">
            <div class="code-header">Code</div>
            <pre><code class="language-python"> 
                #include            
                #include 

                 const char* ssid = "Isaac";       
                 const char* password = "123456789";
                 const char* mqtt_broker = "test.mosquitto.org"; // Broker público

                 const char* topic = "elementos2/Isaac/";
                 const int numMessages = 50;
                 unsigned long sendTimes[numMessages];
                 float latencies[numMessages];

                 WiFiClient espClient;
                 PubSubClient client(espClient);

                 void callback(char* topic, byte* payload, unsigned int length) {
                     unsigned long receivedTime = millis();
                     
                     String message = "";
                     for (int i = 0; i < length; i++) {
                         message += (char)payload[i];
                     }

                     int index = message.substring(4).toInt();
                     if (index >= 0 && index < numMessages) {
                         latencies[index] = (receivedTime - sendTimes[index]) / 1000.0;
                         Serial.printf("Mensaje %d recibido. Latencia: %.6f s\n", index, latencies[index]);
                     } else {
                         Serial.println("Mensaje fuera de rango recibido.");
                     }
                 }


                 void setup_wifi() {
                     WiFi.begin(ssid, password);
                     while (WiFi.status() != WL_CONNECTED) {
                         delay(500);
                     }
                 }

                 void setup() {
                     Serial.begin(115200);
                     setup_wifi();
                     client.setServer(mqtt_broker, 1883);
                     client.setCallback(callback);
                     client.connect("ArduinoClient");
                     client.subscribe(topic);
                 }

                 void loop() {
                     for (int i = 0; i < numMessages; i++) {
                         String message = "msg_" + String(i);
                         sendTimes[i] = millis();
                         client.publish(topic, message.c_str());

                         unsigned long startWait = millis();
                         while (millis() - startWait < 200) {  // Esperar 200ms procesando MQTT
                             client.loop();
                         }
                     }

                     delay(5000);  // Esperar a que lleguen respuestas

                     // Calcular latencia promedio
                     float sum = 0, sumSq = 0;
                     int receivedCount = 0;
                     for (int i = 0; i < numMessages; i++) {
                         if (latencies[i] > 0) {
                             sum += latencies[i];
                             sumSq += latencies[i] * latencies[i];
                             receivedCount++;
                         }
                     }

                     if (receivedCount > 0) {
                         float mean = sum / receivedCount;
                         float stddev = sqrt((sumSq / receivedCount) - (mean * mean));
                         Serial.printf("Latencia promedio: %.6f s\n", mean);
                         Serial.printf("Desviación estándar: %.6f s\n", stddev);
                     } else {
                         Serial.println("No se recibieron respuestas.");
                     }

                     while (true);
                 }


            </code></pre>
        </div>
        <img src="img/microcontroladores/Imagen3.png" width="500px" alt="esp32"> <img src="img/microcontroladores/Imagen4.png" width="500px" alt="esp32">
        Tercera parte: El mensaje se envió desde la computadora a MQTT, y el ESP32-C6 lo recibió. Con esto, se probó la capacidad de recepción del microcontrolador como cliente MQTT, cuando el mensaje proviene desde una computadora.
        <div>
            <center>
                <div class="code-container">
                    <div class="code-header">Código para ESP:</div>
                    <pre><code class="language-python"> 
                        // Configuración WiFi
                        const char* ssid = "Isaac";  
                        const char* password = "123456789";

                        // Configuración del broker MQTT
                        const char* mqtt_server = "test.mosquitto.org";  
                        const char* topic = "elementos2/Isaac";

                        WiFiClient espClient;
                        PubSubClient client(espClient);

                        // Función de conexión WiFi
                        void setup_wifi() {
                            delay(10);
                            //Serial.println("Conectando a WiFi...");
                            WiFi.begin(ssid, password);
                            while (WiFi.status() != WL_CONNECTED) {
                                delay(500);
                                Serial.print(".");
                            }
                            Serial.println("\nWiFi conectado.");
                        }

                        // Función de reconexión MQTT
                        void reconnect() {
                            while (!client.connected()) {
                                //Serial.print("Conectando a MQTT...");
                                if (client.connect("ESP32_Client")) {
                                    //Serial.println("Conectado!");
                                    client.subscribe(topic);  // Suscripción al canal
                                } else {
                                    //Serial.print("Falló. Código: ");
                                    //Serial.print(client.state());
                                    //Serial.println(" Intentando en 5 segundos...");
                                    delay(5000);
                                }
                            }
                        }

                        // Callback cuando se recibe un mensaje MQTT
                        void callback(char* topic, byte* payload, unsigned int length) {
                            Serial.print("Mensaje recibido en el canal: ");
                            Serial.println(topic);
                            Serial.print("Contenido: ");
                            for (unsigned int i = 0; i < length; i++) {
                                Serial.print((char)payload[i]);
                            }
                            Serial.println();
                        }

                        void setup() {
                            Serial.begin(115200);
                            setup_wifi();
                            client.setServer(mqtt_server, 1883);
                            client.setCallback(callback);

                            reconnect();  // Reconectar y suscribirse al canal
                        }

                        void loop() {
                            if (!client.connected()) {
                                reconnect();
                            }
                            client.loop();  // Mantener la conexión MQTT abierta
                        }
                    </code></pre>
                </div>
                Cuarta parte: Se conectó un potenciómetro al ESP32-C6 para enviar los datos leídos a través de MQTT. Esta información se transmitió continuamente al broker, permitiendo observar en tiempo real los datos generados.
                <center>
                    <div class="code-container">
                        <div class="code-header">Código para ESP:</div>
                        <pre><code class="language-python"> 
                            #include 
                            #include 

                            // WiFi
                            const char* ssid = "Isaac";  
                            const char* password = "123456789";

                            // MQTT
                            const char* mqtt_server = "test.mosquitto.org";
                            const char* topic = "elementos2/Isaac";

                            WiFiClient espClient;
                            PubSubClient client(espClient);

                            // Pin del potenciómetro
                            const int potPin = 4;

                            void setup() {
                            Serial.begin(115200);
                            delay(1000);

                            // Conexión WiFi
                            WiFi.begin(ssid, password);
                            Serial.print("Conectando a WiFi");
                            while (WiFi.status() != WL_CONNECTED) {
                                delay(500);
                                Serial.print(".");
                            }
                            Serial.println("\nConectado a WiFi");

                            // Configurar MQTT
                            client.setServer(mqtt_server, 1883);
                            reconnect();
                            }

                            void loop() {
                            if (!client.connected()) {
                                reconnect();
                            }
                            client.loop();

                            // Leer el valor del potenciómetro
                            int potValue = analogRead(potPin);
                            char message[10];
                            sprintf(message, "%d", potValue);

                            // Enviar por MQTT
                            client.publish(topic, message);
                            Serial.print("Valor del potenciómetro enviado: ");
                            Serial.println(potValue);

                            delay(1000);  // Enviar cada 1 segundo
                            }

                            void reconnect() {
                            while (!client.connected()) {
                                Serial.print("Conectando a MQTT...");
                                if (client.connect("ESP32C6_PotClient")) {
                                Serial.println("Conectado al broker MQTT");
                                } else {
                                Serial.print("Error, rc=");
                                Serial.print(client.state());
                                Serial.println(" reintentando en 5 segundos");
                                delay(5000);
                                }
                            }
                            }

            </code></pre>
        </div>
            </head>
    <!-- Blog End -->
    <!-- Blog End -->
    <div class="container-fluid py-5" id="qualification">
        <div class="container">
            <div class="position-relative d-flex align-items-center justify-content-center">
                <h5 class="display-3 text-uppercase text-white" style="-webkit-text-stroke: 1px #dee2e6;">Conclusion</h5>
                <h1 class="position-absolute text-uppercase text-primary">Conclusion</h1>
            </div>
              <P>En esta práctica aplicamos el funcionamiento del protocolo MQTT en diferentes escenarios. Se analizaron los tiempos de transmisión de mensajes desde una computadora y desde un microcontrolador (ESP32-C6), observando la eficiencia del protocolo incluso al enviar grandes cantidades de datos. Además, se demostró la capacidad del ESP32-C6 para recibir mensajes desde un cliente MQTT, validando su utilidad como receptor en sistemas IoT. Finalmente, al integrar un potenciómetro y enviar lecturas en tiempo real al broker, se evidenció cómo MQTT permite una comunicación continua y eficiente entre dispositivos. Estos experimentos refuerzan el valor de MQTT como una herramienta clave para aplicaciones de monitoreo y control en tiempo real dentro del Internet de las Cosas.
        
          
   
  


    <!-- Footer Start -->
    <div class="container-fluid bg-primary text-white mt-5 py-5 px-sm-3 px-md-5">
        <div class="container text-center py-5">
            <div class="d-flex justify-content-center mb-4">
                <a class="btn btn-light btn-social mr-2" href="#"><i class="fab fa-twitter"></i></a>
                <a class="btn btn-light btn-social mr-2" href="#"><i class="fab fa-facebook-f"></i></a>
                <a class="btn btn-light btn-social mr-2" href="#"><i class="fab fa-linkedin-in"></i></a>
                <a class="btn btn-light btn-social" href="#"><i class="fab fa-instagram"></i></a>
            </div>
            <div class="d-flex justify-content-center mb-3">
                <a class="text-white" href="#">Privacy</a>
                <span class="px-3">|</span>
                <a class="text-white" href="#">Terms</a>
                <span class="px-3">|</span>
                <a class="text-white" href="#">FAQs</a>
                <span class="px-3">|</span>
                <a class="text-white" href="#">Help</a>
            </div>
            <p class="m-0">&copy; <a class="text-white font-weight-bold" href="#">Aleman</a>. All Rights Reserved. 
    </div>
    <!-- Footer End -->

    <!-- Scroll to Bottom -->
    <i class="fa fa-2x fa-angle-down text-white scroll-to-bottom"></i>

    <!-- Back to Top -->
    <a href="#" class="btn btn-outline-dark px-0 back-to-top"><i class="fa fa-angle-double-up"></i></a>


    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="lib/typed/typed.min.js"></script>
    <script src="lib/easing/easing.min.js"></script>
    <script src="lib/waypoints/waypoints.min.js"></script>
    <script src="lib/owlcarousel/owl.carousel.min.js"></script>
    <script src="lib/isotope/isotope.pkgd.min.js"></script>
    <script src="lib/lightbox/js/lightbox.min.js"></script>

    <!-- Contact Javascript File -->
    <script src="mail/jqBootstrapValidation.min.js"></script>
    <script src="mail/contact.js"></script>

    <!-- Template Javascript -->
    <script src="js/main.js"></script>
</body>

</html>